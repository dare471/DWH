WITH ALL_DATA AS (
	SELECT sp.[ssilka] as [GUID]
	  ,sp2.[ssilka] as RODITEL_GUID
	  ,sp3.ssilka as RODITEL2_GUID
	  ,sp.[naimenovanie] as [NAIMENOVANIE]
	  ,sp2.[naimenovanie] as RODITEL
	  ,sp3.[naimenovanie] as RODITEL2
	  ,sp4.[naimenovanie] as RODITEL3
	  ,sp5.[naimenovanie] as RODITEL4
	  ,sp6.[naimenovanie] as RODITEL5
	  --,CASE WHEN sp2.naimenovanie='ТОО «Alem Agro Holding (АлемАгро Холдинг)»' THEN NULL ELSE sp2.naimenovanie END as RODITEL
	  --,CASE WHEN sp3.naimenovanie='ТОО «Alem Agro Holding (АлемАгро Холдинг)»' THEN NULL ELSE sp3.naimenovanie END as RODITEL1
	  --,CASE WHEN sp4.naimenovanie='ТОО «Alem Agro Holding (АлемАгро Холдинг)»' THEN NULL ELSE sp4.naimenovanie END  AS RODITEL2
	  ,ISNULL(CASE WHEN sp.eto_direkciya=1 THEN sp.naimenovanie
				  WHEN sp2.eto_direkciya=1 THEN sp2.naimenovanie
				  WHEN sp3.eto_direkciya=1 THEN sp3.naimenovanie
				  WHEN sp4.eto_direkciya=1 THEN sp4.naimenovanie 
				  WHEN sp5.eto_direkciya=1 THEN sp5.naimenovanie
				  WHEN sp6.eto_direkciya=1 THEN sp6.naimenovanie	
			END, CASE WHEN SP2.naimenovanie NOT IN ('Головной офис','Управление цепью поставок','ТОО «Alem Agro Holding (АлемАгро Холдинг)»','Департамент продаж') THEN sp3.naimenovanie ELSE sp.naimenovanie END ) AS DIREKSYA
	  ,ISNULL(CASE WHEN sp.eto_direkciya=1 THEN sp.ssilka
				  WHEN sp2.eto_direkciya=1 THEN sp2.ssilka
				  WHEN sp3.eto_direkciya=1 THEN sp3.ssilka
				  WHEN sp4.eto_direkciya=1 THEN sp4.ssilka
				  WHEN sp5.eto_direkciya=1 THEN sp5.ssilka
			END, CASE WHEN SP2.naimenovanie NOT IN ('Головной офис','Управление цепью поставок','ТОО «Alem Agro Holding (АлемАгро Холдинг)»') THEN sp3.ssilka ELSE sp2.ssilka END ) AS DIREKSYA_GUID
	  ,SP.[tekushchii_rukovoditel] AS TEKUSHCHIY_RUKOVODITEL
	  ,SP.eto_direkciya AS ETO_DIREKCIYA
--INTO [L1].[dbo].[STRUKTURA_PREDPRIYATIYA]
  FROM [L0].[dbo].[struktura_predpriyatiya] sp
  LEFT JOIN [L0].[dbo].[struktura_predpriyatiya] sp2 on sp.roditel=sp2.[ssilka]
  LEFT JOIN [L0].[dbo].[struktura_predpriyatiya] sp3 on sp2.roditel=sp3.[ssilka]
  LEFT JOIN [L0].[dbo].[struktura_predpriyatiya] sp4 on sp3.roditel=sp4.[ssilka]
  LEFT JOIN [L0].[dbo].[struktura_predpriyatiya] sp5 on sp4.roditel=sp5.[ssilka]
  LEFT JOIN [L0].[dbo].[struktura_predpriyatiya] sp6 on sp5.roditel=sp6.[ssilka]
  --WHERE SP.pometka_udaleniya=0
  --ORDER BY SP.eto_direkciya,SP.naimenovanie
  )


  SELECT
  ISNULL(CASE WHEN ALL_DATA.GUID IN (0x80D100155D01C90111E7BA3DBCAE082D,0xA2347085C2A4312A11EB513AD899E0F3,0xA23A7085C2A4312A11EB7A6C9F9F8345,0xA21F7085C2A4312A11E9F3ED3C9B242B,0xA21F7085C2A4312A11E9F3ED4BF69FBD,
								0xA21F7085C2A4312A11E9F3ED549FEE71,0xA21F7085C2A4312A11E9F3EAEC43CFD5) THEN 'Дирекция "ЦЕНТР"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3EC693849B2,0xA2337085C2A4312A11EB394D9453908F,0xA2367085C2A4312A11EB660345F1B0EF,0xA21F7085C2A4312A11E9F3EC717B5555,0xA21F7085C2A4312A11E9F3EC717B5557,
								0xA21F7085C2A4312A11E9F3E8E6FC6E05,0xA21F7085C2A4312A11E9F3EC88DA1520) THEN 'Дирекция "ЗАПАД"' 
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3EEC36689ED,0xA21F7085C2A4312A11E9F3F2EE66859A,0x80D200155D01C90111E7BF9399E4EF5B,0xA21F7085C2A4312A11E9F3F56310D2B0,0xA21F7085C2A4312A11E9FAD6CD4F178B,
								0xA21F7085C2A4312A11E9F3F56DFDBA52,0x80D100155D01C90111E7B97B3C6E1069,0xA21F7085C2A4312A11E9F3F583CB68C7,0xA21F7085C2A4312A11E9F3F59048CA92,0xA21F7085C2A4312A11E9FAD68B836562,
								0xBFC5B8CB29F9512311ED987A6A2497AD) THEN 'Дирекция "ЮГ"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3E7E288CFC3,0xAF90D4F5EF10792511ED195B1AF21289,0xA21F7085C2A4312A11E9F3E80BE8C7D2,0xA2337085C2A4312A11EB38593FCC6BEE,0xA21F7085C2A4312A11E9F3E7AA56EC06,
								0xA21F7085C2A4312A11E9F3E8F00A3886,0xAF8DD4F5EF10792511EC8262C29B80A8,0xA21F7085C2A4312A11E9F3E8F00A3888,0xA21F7085C2A4312A11E9F3E8FA9A7E98,0xA21F7085C2A4312A11E9F3E8FA9A7E9A) THEN 'Дирекция "ВОСТОК"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3ECC8A561B2,0xA21F7085C2A4312A11E9F3ECE10F5BDD,0xA21F7085C2A4312A11E9F3ECE8DB2901,0xA21F7085C2A4312A11E9F3ECF376B053) THEN 'Дирекция "СЕВЕР 2"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3ED0871D42B,0xAF8DD4F5EF10792511EC78140EB94926,0xAF8DD4F5EF10792511EC8262B9F50341,0xAF8ED4F5EF10792511EC988BF622EB51,0xA21F7085C2A4312A11E9F3ED1662C80B,
								0xA21F7085C2A4312A11E9F3ED1662C80D,0xA2307085C2A4312A11EAE04AD96267E1) THEN 'Дирекция "СЕВЕР 1"'

  END ,ISNULL(CASE WHEN DIREKSYA!='Удаленные' THEN DIREKSYA ELSE NULL END,NAIMENOVANIE))
  ,ISNULL(CASE WHEN DIREKSYA!='Удаленные' THEN DIREKSYA ELSE NULL END,NAIMENOVANIE)
  ,CASE WHEN ALL_DATA.GUID IN (0x80D100155D01C90111E7BA3DBCAE082D,0xA2347085C2A4312A11EB513AD899E0F3,0xA23A7085C2A4312A11EB7A6C9F9F8345,0xA21F7085C2A4312A11E9F3ED3C9B242B,0xA21F7085C2A4312A11E9F3ED4BF69FBD,
								0xA21F7085C2A4312A11E9F3ED549FEE71,0xA21F7085C2A4312A11E9F3EAEC43CFD5) THEN 'Дирекция "ЦЕНТР"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3EC693849B2,0xA2337085C2A4312A11EB394D9453908F,0xA2367085C2A4312A11EB660345F1B0EF,0xA21F7085C2A4312A11E9F3EC717B5555,0xA21F7085C2A4312A11E9F3EC717B5557,
								0xA21F7085C2A4312A11E9F3E8E6FC6E05,0xA21F7085C2A4312A11E9F3EC88DA1520) THEN 'Дирекция "ЗАПАД"' 
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3EEC36689ED,0xA21F7085C2A4312A11E9F3F2EE66859A,0x80D200155D01C90111E7BF9399E4EF5B,0xA21F7085C2A4312A11E9F3F56310D2B0,0xA21F7085C2A4312A11E9FAD6CD4F178B,
								0xA21F7085C2A4312A11E9F3F56DFDBA52,0x80D100155D01C90111E7B97B3C6E1069,0xA21F7085C2A4312A11E9F3F583CB68C7,0xA21F7085C2A4312A11E9F3F59048CA92,0xA21F7085C2A4312A11E9FAD68B836562,
								0xBFC5B8CB29F9512311ED987A6A2497AD) THEN 'Дирекция "ЮГ"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3E7E288CFC3,0xAF90D4F5EF10792511ED195B1AF21289,0xA21F7085C2A4312A11E9F3E80BE8C7D2,0xA2337085C2A4312A11EB38593FCC6BEE,0xA21F7085C2A4312A11E9F3E7AA56EC06,
								0xA21F7085C2A4312A11E9F3E8F00A3886,0xAF8DD4F5EF10792511EC8262C29B80A8,0xA21F7085C2A4312A11E9F3E8F00A3888,0xA21F7085C2A4312A11E9F3E8FA9A7E98,0xA21F7085C2A4312A11E9F3E8FA9A7E9A) THEN 'Дирекция "ВОСТОК"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3ECC8A561B2,0xA21F7085C2A4312A11E9F3ECE10F5BDD,0xA21F7085C2A4312A11E9F3ECE8DB2901,0xA21F7085C2A4312A11E9F3ECF376B053) THEN 'Дирекция "СЕВЕР 2"'
		WHEN ALL_DATA.GUID IN (0xA21F7085C2A4312A11E9F3ED0871D42B,0xAF8DD4F5EF10792511EC78140EB94926,0xAF8DD4F5EF10792511EC8262B9F50341,0xAF8ED4F5EF10792511EC988BF622EB51,0xA21F7085C2A4312A11E9F3ED1662C80B,
								0xA21F7085C2A4312A11E9F3ED1662C80D,0xA2307085C2A4312A11EAE04AD96267E1) THEN 'Дирекция "СЕВЕР 1"'

  END 
  ,ALL_DATA.*
  
  
  FROM ALL_DATA 
  --WHERE DIREKSYA='Удаленные'
  ORDER BY NAIMENOVANIE
